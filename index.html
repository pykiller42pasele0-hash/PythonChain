<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>PythonChain Explorer & Wallet</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #e0e0e0; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1 { color: #4CAF50; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        
        /* Bereich fuer Transaktionen */
        .transaction-form { background: #1e1e1e; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid #333; }
        input { background: #2c2c2c; border: 1px solid #444; color: white; padding: 10px; margin: 5px; border-radius: 4px; width: 200px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #45a049; transform: scale(1.05); }

        /* Block Darstellung */
        .block-card { background: #1e1e1e; border-left: 5px solid #4CAF50; margin: 15px 0; padding: 20px; border-radius: 8px; text-align: left; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .hash-text { font-family: 'Courier New', monospace; color: #888; font-size: 0.9em; word-break: break-all; }
        .tx-list { font-size: 0.85em; color: #bbb; background: #252525; padding: 10px; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>PythonChain Explorer</h1>
        
        <div class="transaction-form">
            <h3>Neue Transaktion senden</h3>
            <input type="text" id="sender" placeholder="Absender (z.B. Justin)">
            <input type="text" id="recipient" placeholder="Empfaenger">
            <input type="number" id="amount" placeholder="Betrag">
            <button onclick="sendTransaction()">Senden</button>
        </div>

        <button style="background: #2196F3;" onclick="mineBlock()">Hammer-Icon: Neuen Block minen</button>
        <hr style="border: 0.5px solid #333; margin: 30px 0;">
        
        <div id="chainDisplay"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';

        async function loadChain() {
            try {
                const response = await fetch(`${API_URL}/chain`);
                const data = await response.json();
                const display = document.getElementById('chainDisplay');
                
                // Wir zeigen die Kette umgekehrt an (neueste Blöcke oben)
                display.innerHTML = data.chain.reverse().map(b => `
                    <div class="block-card">
                        <h3>Block #${b.index} <span style="font-size: 0.6em; color: #666;">| Proof: ${b.proof}</span></h3>
                        <p><strong>Vorheriger Hash:</strong><br><span class="hash-text">${b.previous_hash}</span></p>
                        <div class="tx-list">
                            <strong>Transaktionen:</strong> ${b.transactions.length > 0 ? 
                                b.transactions.map(t => `<br>• ${t.sender} -> ${t.recipient}: ${t.amount} Coins`).join('') 
                                : '<br>Keine Transaktionen'}
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.log("Server nicht erreichbar. Starte deine app.py!");
            }
        }
        
        async function mineBlock() {
            const response = await fetch(`${API_URL}/mine`);
            const data = await response.json();
            alert("Erfolg: " + data.message);
            loadChain();
        }

        async function sendTransaction() {
            const sender = document.getElementById('sender').value;
            const recipient = document.getElementById('recipient').value;
            const amount = document.getElementById('amount').value;

            if(!sender || !recipient || !amount) return alert("Bitte alle Felder ausfuellen!");

            const response = await fetch(`${API_URL}/transactions/new`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sender, recipient, amount: parseFloat(amount) })
            });
            
            const data = await response.json();
            alert(data.message);
            // Felder leeren
            document.getElementById('recipient').value = '';
            document.getElementById('amount').value = '';
        }

        // Initiales Laden
        loadChain();
        // Alle 10 Sekunden automatisch aktualisieren
        setInterval(loadChain, 10000);
    </script>
</body>
</html>