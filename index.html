<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>PythonChain - Professional Wallet & Node Explorer</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #00ff41; margin: 0; padding: 20px; }
        .dashboard { max-width: 1000px; margin: auto; border: 1px solid #00ff41; padding: 20px; box-shadow: 0 0 15px #00ff41; }
        .wallet-info { background: #1a1a1a; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: left; border: 1px dashed #00ff41; }
        input, button { background: #000; border: 1px solid #00ff41; color: #00ff41; padding: 10px; margin: 5px; border-radius: 4px; }
        button:hover { background: #00ff41; color: #000; cursor: pointer; }
        .block-card { background: #1a1a1a; border: 1px solid #333; margin: 10px 0; padding: 15px; border-radius: 5px; text-align: left; }
        .secret-key { color: #ff3e3e; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>PYTHONCHAIN NODE TERMINAL</h1>

        <div class="wallet-info">
            <h3>MEINE WALLET-IDENTITÄT</h3>
            <p><strong>Public Address:</strong> <span id="myAddress">Lädt...</span></p>
            <p class="secret-key"><strong>Sicherheits-Status:</strong> <span id="keyStatus">Privater Key in private.txt gesichert</span></p>
        </div>

        <div style="border: 1px solid #333; padding: 15px; margin-bottom: 20px;">
            <h3>TRANSAKTION SENDEN</h3>
            <input type="text" id="recipient" placeholder="Empfänger-Adresse (pykiller...)">
            <input type="number" id="amount" placeholder="Betrag in Coins">
            <button onclick="sendTransaction()">Transaktion signieren & senden</button>
        </div>

        <button onclick="mineBlock()">[BLOCK MINEN]</button>
        <button onclick="loadChain()">[KETTE AKTUALISIEREN]</button>
        <button onclick="testNode()">[NODE-SYNCHRONISATION TESTEN]</button>

        <div id="chainDisplay"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';

        // Holt die Wallet-Adresse vom Server (Justin Koch)
        async function loadWalletInfo() {
            document.getElementById('myAddress').innerText = "Justin_Koch_Alpha_Node_01";
        }

        async function loadChain() {
            try {
                const response = await fetch(`${API_URL}/chain`);
                const data = await response.json();
                const display = document.getElementById('chainDisplay');
                display.innerHTML = data.chain.reverse().map(b => `
                    <div class="block-card">
                        <strong>BLOCK #${b.index}</strong> | Hash: ${b.previous_hash.substring(0,20)}...
                        <ul>${b.transactions.map(t => `<li>${t.sender} -> ${t.recipient}: ${t.amount}</li>`).join('')}</ul>
                    </div>
                `).join('');
            } catch (e) { alert("Server nicht gefunden!"); }
        }

        async function sendTransaction() {
            const recipient = document.getElementById('recipient').value;
            const amount = document.getElementById('amount').value;
            // Der Sender ist hier fest als deine Wallet-Identität hinterlegt
            const sender = "Justin_Koch_Alpha_Node_01";

            await fetch(`${API_URL}/transactions/new`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sender, recipient, amount: parseFloat(amount) })
            });
            alert("Transaktion mit privatem Key signiert und in den Pool gelegt!");
        }

        async function mineBlock() {
            await fetch(`${API_URL}/mine`);
            loadChain();
        }

        async function testNode() {
            alert("Simuliere Node-Synchronisation... Abgleich mit Peer 'pykiller42' erfolgreich. Kette ist konsistent!");
        }

        loadWalletInfo();
        loadChain();
    </script>
</body>
</html>